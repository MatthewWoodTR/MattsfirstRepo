name: Prefix PRD filenames with Engagement Manager
on:
  workflow_dispatch:

permissions:
  contents: write

jobs:
  prefix:
    runs-on: ubuntu-latest
    steps:
      - name: Checkout current ref
        uses: actions/checkout@v4
        with:
          fetch-depth: 0
          persist-credentials: true
          ref: ${{ github.ref_name }}

      - name: Prefix filenames
        shell: bash
        run: |
          set -euo pipefail
          shopt -s nullglob
          changed=0
          for f in PRDs/2025-11/*.docx; do
            b="$(basename "$f")"
            d="$(dirname "$f")"
            if [[ "$b" != "[Engagement Manager]"* ]]; then
              git mv "$f" "$d/[Engagement Manager] $b"
              changed=1
            fi
          done
          echo "CHANGED=$changed" >> $GITHUB_ENV

      - name: Commit changes
        if: env.CHANGED == '1'
        uses: stefanzweifel/git-auto-commit-action@v5
        with:
          commit_message: "chore(prd): prefix filenames with [Engagement Manager]"
          branch: ${{ github.ref_name }}

      - name: No changes to commit
        if: env.CHANGED != '1'
        run: echo "No files required renaming."
